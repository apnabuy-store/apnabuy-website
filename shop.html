<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shop Profile | ApnaBuy</title>

  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

<header class="header">
  <div class="brand">
    <img src="images/logo.png" class="logo">
    <div class="brand-text">
      <span class="brand-name">ApnaBuy</span>
      <span class="tagline">Buy local. Live local.</span>
    </div>
  </div>
</header>

<section class="shop-profile">
  <img id="shopImage" class="shop-banner">

  <h1 id="shopName"></h1>
  <div id="shopMeta"></div>

  <p id="shopAddress"></p>
  <p id="shopTiming"></p>
  <a id="mapLink" target="_blank" class="map-link">üìç View on Map</a>
</section>

<section class="products">
  <h2>Products</h2>
  <div class="product-grid" id="productGrid"></div>
</section>

<section class="reviews">
  <h2>Customer Reviews</h2>
  <div id="reviewGrid"></div>
</section>

<script>
/* ================= DATA (MUST MATCH index.html) ================= */

const shopsData = {
  "444601": [
    {
      name: "Shree Mobile Shop",
      image: "images/shree-mobile-shop.jpg",
      rating: 4.6,
      address: "Main Road, Amravati",
      timing: "10 AM ‚Äì 9 PM",
      map: "https://www.google.com/maps/search/Shree+Mobile+Shop+Amravati",
      products: [
        { name: "Realme 65W Charger", price: "‚Çπ2,499", image: "images/realme65w.jpg" },
        { name: "Type-C Fast Charging Cable", price: "‚Çπ399", image: "images/realme65w.jpg" }
      ],
      reviews: [
        { name: "Rahul P", rating: 5, text: "Genuine shop and fast service." },
        { name: "Anjali S", rating: 4, text: "Good pricing." }
      ]
    },
    {
      name: "Sai Electronics",
      image: "images/sai-electronics.jpg",
      rating: 4.3,
      address: "Market Area, Amravati",
      timing: "9:30 AM ‚Äì 8:30 PM",
      map: "https://www.google.com/maps/search/Sai+Electronics+Amravati",
      products: [
        { name: "Bluetooth Neckband", price: "‚Çπ1,299", image: "images/realme65w.jpg" }
      ],
      reviews: [
        { name: "Suresh K", rating: 4, text: "Nice collection and fair prices." },
        { name: "Neha M", rating: 5, text: "Very helpful staff." }
      ]
    }
  ]
};

/* ================= URL PARAMS ================= */

const params = new URLSearchParams(window.location.search);
const pin = params.get("pin");
const shopIndex = Number(params.get("shop"));

if (!shopsData[pin] || isNaN(shopIndex) || !shopsData[pin][shopIndex]) {
  document.body.innerHTML = `
    <div style="padding:40px;text-align:center;">
      <h2>Shop not found</h2>
      <p>Please go back and select a valid shop.</p>
    </div>
  `;
  throw new Error("Invalid shop index");
}

const shop = shopsData[pin][shopIndex];

/* ================= RENDER SHOP ================= */

document.getElementById("shopImage").src = shop.image;
document.getElementById("shopName").innerText = shop.name;
document.getElementById("shopMeta").innerText = `‚≠ê ${shop.rating} / 5`;
document.getElementById("shopAddress").innerText = `üìç ${shop.address}`;
document.getElementById("shopTiming").innerText = `‚è∞ ${shop.timing}`;
document.getElementById("mapLink").href = shop.map;

/* ================= PRODUCTS ================= */

const productGrid = document.getElementById("productGrid");

shop.products.forEach(p => {
  productGrid.innerHTML += `
    <div class="product-card">
      <img src="${p.image}">
      <h4>${p.name}</h4>
      <strong>${p.price}</strong>

      <button class="buy-btn"
        onclick="buyFromProfileWithDetails(
          '${p.name}',
          '${p.price}',
          '${shop.name}',
          '${pin}'
        )">
        Buy on WhatsApp
      </button>
    </div>
  `;
});

/* ================= ORIGINAL FUNCTION (UNCHANGED) ================= */

function buyFromProfile(name, price, shop, pin) {
  const msg = `
Hello ApnaBuy Team üëã

üì¶ Product: ${name}
üí∞ Price: ${price}
üè™ Shop: ${shop}
üìç Pincode: ${pin}

Please confirm availability.
`.trim();

  window.open(
    `https://wa.me/919730572143?text=${encodeURIComponent(msg)}`,
    "_blank"
  );
}

/* ================= NEW WRAPPER (ONLY ADDITION) ================= */

function buyFromProfileWithDetails(name, price, shop, pin) {
  const customerName = prompt("Enter your name:");
  if (!customerName) return;

  const customerPhone = prompt("Enter your mobile number:");
  if (!customerPhone) return;

  const customerEmail = prompt("Enter your email (optional):") || "N/A";

  // Optionally store for session reuse
  sessionStorage.setItem("apnabuy_customer", JSON.stringify({
    name: customerName,
    phone: customerPhone,
    email: customerEmail
  }));

  buyFromProfile(name, price, shop, pin);
}

/* ================= REVIEWS ================= */

const reviewGrid = document.getElementById("reviewGrid");
shop.reviews.forEach(r => {
  reviewGrid.innerHTML += `
    <div class="review-card">
      ‚≠ê ${r.rating} ‚Äì <strong>${r.name}</strong>
      <p>${r.text}</p>
    </div>
  `;
});
</script>

</body>
</html>
